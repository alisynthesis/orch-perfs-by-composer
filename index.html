<!DOCTYPE html>
<meta charset="utf-8">

<head> 
    
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">    
    <link href="http://getbootstrap.com/examples/justified-nav/justified-nav.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body>
	<div class="container">
		<div class="jumbotron">
			<svg id="visualization" width="1000" height="500"></svg>

			<!-- load the d3.js library -->    
			<script src="http://d3js.org/d3.v3.min.js"></script>

			<script>

			// Set the dimensions of the canvas / graph
			var margin = {top: 30, right: 50, bottom: 70, left: 50},
			    width = 1000 - margin.left - margin.right,
			    height = 500 - margin.top - margin.bottom;

			// Set the ranges
			var x = d3.scale.linear().range([0, width]);
			var y = d3.scale.linear().range([height, 0]);

			// Define the axes
			var xAxis = d3.svg.axis().scale(x)
			    .orient("bottom").ticks(5).tickFormat(d3.format("d"));

			var yAxis = d3.svg.axis().scale(y)
			    .orient("left");

			// Define the line
			var priceline = d3.svg.line()
			    .x(function(d) { return x(d.year); })
			    .y(function(d) { return y(d.perfs); })
			    .interpolate("basis");
			    
			// Adds the svg canvas
			var svg = d3.select("#visualization")
			    .append("svg")
			        .attr("width", width + margin.left + margin.right)
			        .attr("height", height + margin.top + margin.bottom)
			    .append("g")
			        .attr("transform", 
			              "translate(" + margin.left + "," + margin.top + ")");

			// Get the data
			d3.csv("am-orch-rep-1842-1970-top-five-perf-count.csv", function(error, data) {
			    data.forEach(function(d) {
			  d.year = +d.year;
			  d.perfs = +d.perfs;
			    });

			    // Scale the range of the data
			    x.domain(d3.extent(data, function(d) { return d.year; }));
			    // y.domain([0 , 50]); 
			    y.domain([d3.min(data, function(d) {
			        return d.perfs;
			    }), d3.max(data, function(d) {
			        return d.perfs;
			    })]);

			    // Nest the entries by symbol
			    var dataNest = d3.nest()
			        .key(function(d) {return d.composerlast;})
			        .entries(data);

			    var color = d3.scale.category10();  // set the colour scale

			    legendSpace = width/dataNest.length; // spacing for legend

			    // Loop through each symbol / key
			    dataNest.forEach(function(d,i) {

			        svg.append("path")
			            .attr("class", "line")
			            .style("stroke", function() { // add color dynamically
			            	return d.color = color(d.key);})
			            .attr("id", 'tag'+d.key.replace(/\s+/g, '')) // assign ID
			            .attr("d", priceline(d.values));

			        svg.append("text")
			        	.attr("x", (legendSpace/2)+i*legendSpace) // spacing
			        	.attr("y", height + (margin.bottom/2)+ 5)
			        	.attr("class", "legend") //style the legend
			        	.style("fill", function() {
			        		return d.color = color(d.key);})
			        	.on("click", function() {
			        		//Determine if current line is visible
			        		var active = d.active ? false : true,
			        		newOpacity = active ? 0 : 1;
			        		// Hide or show the elements based on the ID
			        		d3.select("#tag"+d.key.replace(/\s+/g, ''))
			        			.transition().duration(100)
			        			.style("opacity", newOpacity);
			    			// Update whether or not the elements are active
			    			d.active = active;
			        	})
			        	.text(d.key);

			    });

			    // Add the X Axis
			    svg.append("g")
			        .attr("class", "x axis")
			        .attr("transform", "translate(0," + height + ")")
			        .call(xAxis);

			    // Add the Y Axis
			    svg.append("g")
			        .attr("class", "y axis")
			        .call(yAxis);

			});

			</script>
			
		</div>
	</div>
</body>